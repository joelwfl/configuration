define(["jquery","underscore"],function(){function d(a){a=JSON.parse(a);return a.taskId?a.taskId:null}var e={};return{initializeAlerts:function(){chrome.notifications.onClosed.addListener(function(a,c){var b=d(a);c&&(chrome.runtime.sendMessage({type:"alert",alert:"dismiss",id:b}),track(["Notification","Manually Closed"]));e.closeCallback&&e.closeCallback(b)});chrome.notifications.onClicked.addListener(function(a){messageBackgroundPage({type:"highlightTask",highlightedTask:d(a)});track(["Notification",
"Clicked Notification"])});chrome.notifications.onButtonClicked.addListener(function(a,c){var b=d(a);console.log("clicked on",c,"for task",b);0===c?(messageBackgroundPage({type:"alert",alert:"snooze",minutes:60,id:b}),track(["Notification","Clicked Snooze","1 hour"])):(messageBackgroundPage({type:"alert",alert:"done",id:b}),track(["Notification","Clicked Done"]));chrome.notifications.clear(b,function(){})})},showAlert:function(a,c){e.closeCallback=c;var b=JSON.stringify({taskId:a.id,due:a.alertTime});
chrome.notifications.create(b,{type:"basic",iconUrl:chrome.runtime.getURL("images/bell.png"),title:a.title,message:a.formattedTime+", "+a.category,eventTime:a.alertTime,buttons:[{title:"Snooze 1 hour",iconUrl:chrome.runtime.getURL("images/snooze.png")},{title:"Done",iconUrl:chrome.runtime.getURL("images/done.png")}]},function(){track(["Notification","Shown"])})}}});