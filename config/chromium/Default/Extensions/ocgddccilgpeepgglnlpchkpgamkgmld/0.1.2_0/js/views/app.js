define("jquery,underscore,backbone,libs/jquery/jquery.caret.1.02,windows/loginwindow,windows/forgotwindow,windows/newuserwindow,windows/registerwindow,windows/taskwindow,collections/task,collections/category,helpers/getFetchOptions,server/auth,server/sync,views/loading,config/user,config/global,less,base64".split(","),function(a,d,f,s,g,h,i,j,k,l,m,t,e,u,v,n,o,w,p){return f.View.extend({el:a("#app"),initialize:function(){d.bindAll(this,"showTaskList");this.windowContainer=a(this.el).find(".window-container");
window.createGlobalId=function(){for(var a="",c=0;c<16;c++)a=a+String.fromCharCode(Math.random()*256);return p.encodeBase64(a).replace(/\//g,"_").replace(/\+/g,"-")};window.userValues={};storage.get(null,function(a){userValues=a||{}});chrome.storage.onChanged.addListener(function(a){d.each(a,function(a,b){userValues[b]=a.newValue})});this.tasks=new l([],{app:this});this.categories=new m;this.mainLoginWindow=(new g({app:this})).render();this.mainRegisterWindow=(new j({app:this})).render();this.mainNewUserWindow=
(new i({app:this})).render();this.mainForgotWindow=(new h({app:this})).render();a(this.mainRegisterWindow.el).appendTo(this.windowContainer);a(this.mainNewUserWindow.el).appendTo(this.windowContainer);a(this.mainLoginWindow.el).appendTo(this.windowContainer);a(this.mainForgotWindow.el).appendTo(this.windowContainer);this.offlineMasks=a(".offline-mask");this.offlineMask=a(".offline-mask.main-offline-mask");this.offlineLoggedoutMask=a(".offline-mask.logged-out");this.userConfig=null;this.globalConfig=
new o;a(".keyboard-shortcuts").on("click",function(){a(this).removeClass("show")});a(".appmask [dismiss]").click(function(b){b&&b.preventDefault();a(this).parents(".appmask").removeClass("show")});a(window).on("click",".offline-mode-notice a",function(a){a.preventDefault();this.offlineMask.addClass("show")}.bind(this));a(window).scroll(function(){window.scrollTo(0,a(window).scrollTop())});this.writeTriggers=".check-button, .icon-set-priority, .icon-set-folder, .icon-set-alert";a(window).on({online:this.onOnline.bind(this),
offline:this.onOffline.bind(this),keypress:this.onKeypress.bind(this)});navigator.onLine==false&&this.onOffline.call(this);console.log("Trying to log in...");e.tryLogIn(this.showTaskList,d.bind(this.mainRegisterWindow.show,this));if(typeof chrome!="undefined"){window.addEventListener("message",function(b){b=b.data;switch(b.action){case "refreshTab":this.mainTaskWindow&&this.mainTaskWindow.tasks.fetch();break;case "facebookConnectComplete":this.mainTaskWindow||this.showTaskList();break;case "logOut":e.logOut();
break;case "collectionUpdated":var c=JSON.parse(b.collection),q=d.map(c,function(a){return{id:a.id,lastUpdateDate:(new Date(a.lastUpdateDate)).setMilliseconds(0),title:a.title,name:a.name}}),r=d.map(app[b.type].models,function(a){return{id:a.attributes.id,lastUpdateDate:(new Date(a.attributes.lastUpdateDate)).setMilliseconds(0),title:a.attributes.title,name:a.attributes.name}});if(JSON.stringify(q)!==JSON.stringify(r)){console.log("collections differ");a(".calendar-window").is(":visible")?console.log("Keeping quiet about server changes, finish with your calendar first."):
app[b.type].reset(c)}}}.bind(this));var c=function(b,c){a(document).on("ajaxSend",function(a,d){d.setRequestHeader(b,c)})};c("AnyDO-Version","0.1.0.5");storage.get("userPuid",function(a){a&&a.puid!=null&&c("AnyDO-Puid",a.puid)})}},onOnline:function(){console.log("ONLINE");messageBackgroundPage({type:"pollServer"});a("html").removeClass("readonly-mode");this.offlineMasks.removeClass("show")},onOffline:function(){console.log("OFFLINE");a("html").addClass("readonly-mode");setTimeout(function(){a("html").is(".loggedin")==
false&&this.offlineLoggedoutMask.addClass("show")}.bind(this),1500)},allowShortcut:function(c){var b=false,b=a(document.elementFromPoint(0,0)).parents("[sortby]").length>0;c=="?"&&a(".keyboard-shortcuts:visible")&&(b=true);return b},onKeypress:function(c){if(!a(c.target).is(":input")){var b=String.fromCharCode(c.which);if(this.allowShortcut(b)){c.preventDefault();switch(b){case "+":a(".quickadd-button:first").click();break;case " ":a(".sortby.selected").click();break;case "v":case "V":a(".sortby:not(.selected)").click();
break;case "?":a(".keyboard-shortcuts").toggleClass("show")}}}},popOutMode:function(){return document.location.hash=="#popup"},showTaskList:function(){console.log("Showing task list...");this.userConfig=new n;this.mainLoginWindow.hide();this.mainRegisterWindow.hide();this.mainForgotWindow.hide();this.mainNewUserWindow.hide();this.mainTaskWindow=(new k({app:this})).render();a(this.mainTaskWindow.el).appendTo(this.windowContainer);this.mainTaskWindow.show();a("html").addClass("loggedin")},validName:function(a){return a.length>=
3},validEmail:function(a){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(a)},validPassword:function(a){return a.length>=6},refreshBackground:function(){typeof chrome!="undefined"?window.postMessage({type:"refreshTab"},"*"):console.log("Implement me!")},checkReminders:function(){typeof chrome!="undefined"?window.postMessage({type:"refreshTab"},"*"):console.log("Implement me!")},trackClick:function(){typeof chrome!=
"undefined"?_gaq.push(["_trackEvent"].concat(a.makeArray(arguments))):console.log("Implement me!")},trackPageview:function(){typeof chrome!="undefined"?_gaq.push(["_trackPageview"].concat(a.makeArray(arguments))):console.log("Implement me!")}})});